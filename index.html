<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>سجل تقارير MDT</title>
  <link rel="stylesheet" href="styles.css"/>
  <style>
    .report {
      border-bottom: 1px solid #444;
      padding: 15px 0;
    }
    .report img {
      max-width: 100px;
      border-radius: 5px;
      margin-top: 10px;
    }
    .search {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>سجل تقارير MDT</h1>

    <div class="search">
      <input type="text" id="searchInput" placeholder="ابحث باسم الشخص..." oninput="renderReports()" />
    </div>

    <div id="reportList"></div>
  </div>


  <div class="section">
  <label>رمز حذف السجلات:</label>
  <input type="password" id="deleteCode" placeholder="ادخل الرمز السري">
  <button onclick="deleteReports()">حذف جميع السجلات</button>
  <p id="deleteMsg" style="color: red; margin-top: 10px;"></p>
</div>

  

  <script>
    function renderReports() {
    const reportsContainer = document.getElementById("reports-container");
    const reports = JSON.parse(localStorage.getItem("mdtReports")) || [];

    reportsContainer.innerHTML = "";

    if (reports.length === 0) {
        reportsContainer.innerHTML = "<p>لا توجد تقارير.</p>";
        return;
    }

    reports.forEach((report, index) => {
        const reportDiv = document.createElement("div");
        reportDiv.className = "report";
        reportDiv.innerHTML = `
            <h3>الاسم: ${report.personName}</h3>
            <p>مقدم البلاغ: ${report.reporterName}</p>
            <p>حالة المهمة: ${report.missionStatus}</p>
            <p>نوع الحالة: ${report.caseType}</p>
            <p>الرمز الدولي: ${report.personCode}</p>
            <p>معلومات إضافية: ${report.additionalInfo || "لا يوجد"}</p>
            ${report.image ? `<img src="${report.image}" alt="صورة الشخص" width="100">` : ""}
        `;
        reportsContainer.appendChild(reportDiv);
    });

    // <-- هنا تضيف زر حذف السجلات -->
    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "حذف جميع التقارير";
    deleteBtn.onclick = function () {
        const code = prompt("أدخل الرمز السري لحذف جميع التقارير:");
        if (code === "OTRP_LSPD_S2") {
            localStorage.removeItem("mdtReports");
            alert("تم حذف جميع التقارير.");
            location.reload();
        } else {
            alert("رمز خاطئ، لا يمكن الحذف.");
        }
    };

    // إضافة الزر أسفل القائمة
    reportsContainer.appendChild(deleteBtn);
}


      list.innerHTML = filtered.map(r => `
        <div class="report">
          <strong>الوقت:</strong> ${r.timestamp}<br>
          <strong>المُبلّغ:</strong> ${r.reporterName}<br>
          <strong>حالة المهمة:</strong> ${r.missionStatus}<br>
          <strong>نوع الحالة:</strong> ${r.caseType}<br>
          <strong>اسم الشخص:</strong> ${r.personName}<br>
          <strong>معلومات إضافية:</strong> ${r.additionalInfo || 'لا توجد'}<br>
          ${r.imageData ? `<img src="${r.imageData}" alt="صورة الشخص">` : ''}
        </div>
      `).join('') || "<p>لا توجد تقارير تطابق البحث.</p>";
    }

    document.addEventListener("DOMContentLoaded", renderReports);
  </script>
</body>
</html>
